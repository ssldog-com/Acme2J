# Acme2J v0.0.1
æœ¬é¡¹ç›®å®ç°äº† [acme.sh](https://github.com/acmesh-official/acme.sh) çš„**dns**ç”³è¯·è¯ä¹¦æµç¨‹ï¼Œé‡‡ç”¨acme.shçš„é»˜è®¤é…ç½®ï¼Œ
CAä¸º [zerossl](https://zerossl.com) ï¼Œè´¦æˆ·ç§é’¥å’ŒåŸŸåç§é’¥é»˜è®¤ä½¿ç”¨ **ecc-prime256v1** ç”Ÿæˆï¼Œæš‚ä¸æ”¯æŒå…¶ä»–åŠ å¯†å½¢å¼ã€‚
è·å–çš„è¯ä¹¦å¯ç”¨äº **yourdomain.com** å’Œ ***.yourdomain.com**ã€‚

This program implements the default certificate application process of [acme.sh](https://github.com/acmesh-official/acme.sh), using dns-txt,
The CA is [zerossl](https://zerossl.com), and the account private key and domain private key are generated by **ecc-prime256v1** as default. Other encryption forms are not supported at present
The certificate supports both **yourdomain.com** and ***.yourdomain.com**.

#å†™è¿™ä¸ªé¡¹ç›®çš„ç›®çš„æ˜¯ä¸ºäº†å®éªŒåœ¨Windowsä¸Šç”³è¯·Zerosslçš„é€šé…ç¬¦è¯ä¹¦ï¼Œç°åœ¨å®ç°äº†ï¼Œä¼°è®¡æ—¥åä¸ä¼šå†æ›´æ–°äº†ã€‚#

#The purpose of writing this project was to test applying for a wildcard certificate for Zerossl on Windows, and it is now implemented and it is estimated that it will not be updated in the future.#


## è¿è¡Œè¦æ±‚ / Running requirements
* Java 8+
* Curl
* Openssl
* Echo (Linux, it must support echo -n)

æœ¬é¡¹ç›®è‡ªå¸¦ [jre8](https://adoptium.net/zh-CN/temurin/releases/?version=8) ã€[curl](https://curl.se) å’Œ [openssl-win](https://slproweb.com/products/Win32OpenSSL.html) ã€‚
å‰å¾€ https://adoptium.net/zh-CN/temurin/releases/?version=8 https://curl.se/download.html https://wiki.openssl.org/index.php/Binaries æ‰¾åˆ°é€‚ç”¨äºæ‚¨ç³»ç»Ÿçš„ç‰ˆæœ¬,
åœ¨ Windows ä¸Šä½ ä¸å¿…å®‰è£…ä»–ä»¬ï¼Œå®ƒä»¬éƒ½æ˜¯ä¾¿æºç‰ˆï¼Œè§£å‹å³ç”¨

This project comes with [jre8](https://adoptium.net/zh-CN/temurin/releases/?version=8) , [curl](https://curl.se) and [openssl-win](https://slproweb.com/products/Win32OpenSSL.html).
Go to https://adoptium.net/zh-CN/temurin/releases/?version=8 , https://curl.se/download.html , and https://wiki.openssl.org/index.php/Binaries to find the version for your system,
You don't have to install them on Windows, they're all portable and ready to use


## ä½¿ç”¨ / How to use

### âš™ é…ç½® / conf
* è·¯å¾„éšæ„ï¼Œ**ä¸è¦æœ‰ç©ºæ ¼**ï¼Œæœ€å¥½å…¨è‹±æ–‡è·¯å¾„ 
* å¦‚æœæœªæŒ‡å®šï¼Œå¯¹äºWindowsï¼Œé»˜è®¤ä½¿ç”¨é¡¹ç›®è‡ªå¸¦çš„opensslå’Œcurlï¼›å¯¹äºLinuxï¼Œé»˜è®¤ä½¿ç”¨/usr/bin/opensslå’Œ/usr/bin/curl
* The path where you like and **there should be no spaces** and it is best to follow the path in English<br>
* If not specified, for Windows, using program default. For Linux, using /usr/bin/openssl and /usr/bin/curl
````bash
# win 
openssl=C:/path/to/your/openssl.exe 
curl=C:/path/to/your/curl.exe
# openssl=C:\\path\\to\\your\\openssl.exe 
# curl=C:\\path\\to\\your\\curl.exe

# linux
# openssl=/path/to/your/openssl.exe 
# curl=/path/to/your/curl.exe
````

### ğŸ”„ ç¼–è¯‘ / compile (if you want)
````bash
javac -encoding utf-8 Acme2J.java
````
### â–¶ï¸ è¿è¡Œ / run
````bash
.\java\bin\java.exe Acme2J <æ“ä½œ/options> domain=youdomain.com email=your@email.com
# æ“ä½œ/options: issue continue renew
````

### ğŸ“¤ ç”³è¯·è¯ä¹¦ / issue
````bash
.\java\bin\java.exe Acme2J issue domain=youdomain.com email=your@email.com
````

### ğŸ“ æ·»åŠ dnsè®°å½•å / after you add the DNS records
````bash
.\java\bin\java.exe Acme2J continue domain=youdomain.com email=your@email.com
````

### ğŸ†• æ›´æ–°è¯ä¹¦ / renew
````bash
.\java\bin\java.exe Acme2J renew domain=youdomain.com email=your@email.com
# å®é™…ä¸Šé‡æ–°ç”³è¯·è¯ä¹¦ Actually this will issue a new cert
````
### âŒ åŠé”€è¯ä¹¦ æœªå®ç° / revoke certs NOT implemented



## æ–‡ä»¶è¯´æ˜ / File description

* æ—  ca.cerï¼Œå¯ä»¥ä» domain.cer è‡ªè¡Œè§£æ / No ca.cer, but you can make it from domain.cer
## æ–‡ä»¶è¯´æ˜ / File description

* æ—  ca.cerï¼Œå¯ä»¥ä» domain.cer è‡ªè¡Œè§£æ / No ca.cer, but you can make it from domain.cer

```
â”œâ”€â”€ .gitignore                              
â”œâ”€â”€ account.key         // -> /root/.acme.sh/ca/acme.zerossl.com/v2/DV90/account.key
â”œâ”€â”€ account.json        // -> /root/.acme.sh/ca/acme.zerossl.com/v2/DV90/account.json
â”œâ”€â”€ ca.conf             // -> /root/.acme.sh/ca/acme.zerossl.com/v2/DV90/ca.conf
â”œâ”€â”€ domain                   
â”‚   â”œâ”€â”€ domain.key      // -> /root/.acme.sh/domain_ecc/domain.key      = ssl.key
â”‚   â”œâ”€â”€ domain.cer      // -> /root/.acme.sh/domain_ecc/fullchain.cer   = ssl.pem           
â”‚   â”œâ”€â”€ domian.conf     // -> /root/.acme.sh/domain_ecc/domain.conf              
â”‚   â””â”€â”€ domain.csr.conf // -> /root/.acme.sh/domain_ecc/domain.csr.conf
â”œâ”€â”€ Readme.md                  
â”œâ”€â”€ Acme2J.java                  
â”œâ”€â”€ Acme2J.class    
â””â”€â”€ tools
```

æ‰€æœ‰æ–‡ä»¶æ ¹è·¯å¾„é»˜è®¤åœ¨é¡¹ç›®ç›®å½•ä¸‹ã€‚ä¸acme.shçš„é…ç½®æ–‡ä»¶ä¸åŒï¼Œæœ¬é¡¹ç›®çš„é…ç½®æ²¡æœ‰ç”¨ä½¿ç”¨å•å¼•å·ï¼Œå¦‚ Le_Domain='domain' åœ¨æœ¬é¡¹ç›®ä¸­ä¸º Le_Domain=domainï¼Œ
acme.sh çš„é…ç½®æ–‡ä»¶å¯ä»¥ç”¨äºæœ¬é¡¹ç›®ã€‚

The root path of all files is in the project directory. Unlike the acme.sh configuration file, the configuration of this project is not used with single quotes, e.g. Le_Domain='domain' is Le_Domain=domain in this project, 
and the configuration file of acme.sh can be used for this project.


## âš  æ³¨æ„ / Notice 
*     æœ¬ç¨‹åºä¸æ”¯æŒipè¯ä¹¦ï¼Œä¸æ”¯æŒå¤šåŸŸå / This program does not support IP cert, multi domain are not supported
*     æœ¬ç¨‹åºæœªéµå¾ªacme.shçš„è®¾è®¡ / This program does not follow the design of acme.sh
*     æœ¬ç¨‹åºæœªç»è¿‡ä¸¥æ ¼æµ‹è¯•ä¸ä¼˜åŒ– / This program has not been strictly tested and optimized
*     ç¦æ­¢æ»¥ç”¨ / Abuse is prohibited
*     ç¦æ­¢ç”¨äºä¸€åˆ‡æŸå®³å…¬å…±åˆ©ç›Šçš„è¡Œä¸º / Any other acts that harm the public interest are prohibited



## æœ€å / In the end
* ç½‘ç»œè¯·æ±‚ç”±curlå®ç°
* å¯†é’¥ã€ç­¾åç­‰åŠŸèƒ½ç”±opensslå®ç°
* Javaè°ƒç”¨ç³»ç»Ÿå‘½ä»¤è¡Œå®ç°å¿…è¦åŠŸèƒ½
* åœ¨ Windows 10/11 å’Œ Ubuntu 20 ä¸Šæµ‹è¯•å¯ç”¨
* æ¶‰åŠ openssl å’Œ curl çš„ä»£ç æˆ‘å·²ç”¨ TODO æ ‡è®°
* é¢å‘è¿‡ç¨‹å¼€å‘ï¼Œç¨‹åºå¾ˆç®€é™‹ï¼Œä½†æ˜¯æ¯” acme.shçš„æºç æ›´æ˜“é˜…è¯»
* æ‰€æœ‰æµç¨‹æ¥è‡ªç”³è¯·è¯ä¹¦æ—¶ acme.sh çš„ç½‘ç»œè¯·æ±‚é¡ºåºï¼Œå¹¶ç»“åˆæºç å¼€å‘
* æ³¨æ„é¡¹ç›®ä¸­çš„æŸäº›æ–¹æ³•ä¸å®Œå–„ï¼Œå¾ˆ"éš¾ç”¨ä¸”å±é™©"æ¯”å¦‚ valueFor
* æœ¬é¡¹ç›®æ—¨åœ¨æè¿°ä¸€ä¸ªå®Œæ•´çš„acme.shç”³è¯·æµç¨‹ï¼Œæå–å…¶ä¸­æœ€é‡è¦çš„æ­¥éª¤ä¸æ–¹æ³•ä½œä¸ºæ—¥åå¼€å‘å…¶ä»–é¡¹ç›®çš„å‚è€ƒ
* å¦‚æœä½ æƒ³å‚è€ƒæœ¬é¡¹ç›®äºŒæ¬¡å¼€å‘ï¼Œä½ å¿…é¡»é˜…è¯» acme.sh çš„æºç ï¼Œå‚è€ƒå…¶ä¸­çš„å¯èƒ½çš„é™åˆ¶æ¡ä»¶ï¼Œå¦‚ retry-after ç­‰
* è¿è¡Œacme.shæ—¶æŒ‡å®š`acme.sh --issue --dns -d yourdoamain --yes-I-know-dns-manual-mode-enough-go-ahead-please --output-insecure --debug 3`å¯ä»¥å¾—åˆ°è¯¦ç»†æ—¥å¿—
* é…ç½®curlå…¨å±€è·³è¿‡è¯ä¹¦éªŒè¯ æˆ–è€… å°† acme.sh ä¸­çš„ `_CURL -` æ›¿æ¢ä¸º `_CURL -k -` å¯ä»¥å¸®åŠ©ä½ è¿›è¡Œç½‘ç»œç ”ç©¶
* æ ¹æ®è¿™ä¸ªé¡¹ç›®ç»™å‡ºçš„æ–¹æ³•æµç¨‹ï¼Œåªè¦è§£å†³äº† curl å’Œ openssl ä½ å°±å¯ä»¥è½»æ¾åœ°å°† acme.sh ç”¨å…¶ä»–ç¼–ç¨‹è¯­è¨€å®ç°ï¼Œåœ¨ä»»ä½•ç¯å¢ƒè¿è¡Œï¼Œç”šè‡³æ˜¯æµè§ˆå™¨ã€‚
* acme.sh é»˜è®¤ ecc ä½†æ˜¯å¯é€‰ rsa `acme.sh --help  -k, --keylength <bits>  Specifies the domain key length: 2048, 3072, 4096, 8192 or ec-256, ec-384, ec-521.  -ak, --accountkeylength <bits>  Specifies the account key length: 2048, 3072, 4096`


* Network request is implemented by curl
* Key, signature and other functions are implemented by openssl
* Java calls the system command line to implement necessary functions
* Tested on Windows 11 and Ubuntu 20
* I have marked the code involving openssl and curl with TODO
* Process-oriented development, the program is very simple, but easier to read than the source code of acme.sh
* All processes come from the network request sequence of acme.sh when applying for a certificate, and are developed in combination with the source code
* Note that some methods in the project are imperfect and "difficult to use and dangerous", such as valueFor() and other methods involving regular expressions
* This project aims to describe a complete acme.sh application process, extract the most important steps and methods as a reference for future development of other projects
* If you want to refer to this project for secondary development, you must read the source code of acme.sh and refer to the possible restrictions, such as retry-after, etc.
* Run acme.sh with `acme.sh --issue --dns -d yourdoamain --yes-I-know-dns-manual-mode-enough-go-ahead-please --output-insecure --debug 3` can get detailed logs
* Configure curl to skip certificate verification globally or replace `_CURL -` in acme.sh with `_CURL -k -` to help you conduct network research
* According to the method flow given in this project, as long as curl and openssl are solved, you can easily implement acme.sh in other programming languages and run it in any environment, even in a browser.
* acme.sh use ecc but can choose rsa.  `acme.sh --help -k, --keylength <bits> Specifies the domain key length: 2048, 3072, 4096, 8192 or ec-256, ec-384, ec-521. -ak, --accountkeylength <bits> Specifies the account key length: 2048, 3072, 4096`
